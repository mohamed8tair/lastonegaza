# دليل نقل البيانات - Migration Guide

## نظرة عامة

تم إنشاء نظام شامل لنقل جميع البيانات الوهمية (Mock Data) إلى قاعدة بيانات Supabase الحقيقية.

## كيفية استخدام النظام

### 1. الوصول إلى صفحة النقل

- افتح التطبيق
- من الصفحة الرئيسية، اضغط على زر "نقل البيانات" في الأعلى
- أو اذهب مباشرة إلى صفحة النقل عن طريق تغيير المسار إلى `/migration`

### 2. تشغيل عملية النقل

1. اضغط على زر "بدء عملية النقل"
2. ستبدأ العملية تلقائياً وستظهر لك شاشة التقدم
3. سيتم نقل البيانات بالترتيب التالي:
   - الأدوار (Roles)
   - الصلاحيات (Permissions)
   - مستخدمي النظام (System Users)
   - المؤسسات (Organizations)
   - العائلات (Families)
   - المستفيدين (Beneficiaries)
   - قوالب الطرود (Package Templates)
   - المندوبين (Couriers)
   - الطرود (Packages)
   - المهام (Tasks)
   - التنبيهات (Alerts)
   - سجل الأنشطة (Activity Log)

### 3. بعد اكتمال النقل

- ستظهر لك رسالة نجاح مع تفاصيل العملية
- يمكنك رؤية عدد السجلات المنقولة لكل جدول
- إذا كانت هناك أخطاء، ستظهر لك التفاصيل
- اضغط على "العودة إلى الصفحة الرئيسية" لبدء استخدام النظام

## ملاحظات مهمة

### الأمان

- ✅ **آمن للتشغيل المتكرر**: يمكنك تشغيل عملية النقل عدة مرات دون مشاكل
- ✅ **يتخطى البيانات الموجودة**: إذا كانت البيانات موجودة بالفعل، سيتم تخطيها
- ✅ **لا يحذف البيانات**: عملية النقل تضيف البيانات فقط ولا تحذف شيئاً

### التحقق من النجاح

بعد النقل، يمكنك التحقق من نجاح العملية عن طريق:

1. الذهاب إلى صفحة المؤسسات - يجب أن ترى قائمة بالمؤسسات
2. الذهاب إلى صفحة المستفيدين - يجب أن ترى قائمة بالمستفيدين
3. الذهاب إلى صفحة العائلات - يجب أن ترى قائمة بالعائلات
4. جميع الصفحات الأخرى يجب أن تعرض البيانات المنقولة

## ما تم تغييره في النظام

### 1. ملفات جديدة

- `src/scripts/migrateData.ts` - السكريبت الرئيسي للنقل
- `src/utils/dataTransformers.ts` - دوال تحويل البيانات
- `src/components/pages/DataMigrationPage.tsx` - واجهة صفحة النقل

### 2. الصفحات المحدثة

تم تحديث الصفحات التالية لإزالة الاعتماد على Mock Data:

- CouriersManagementPage
- FamiliesListPage
- OrganizationsListPage
- AdminDashboard (جزئياً)
- وصفحات أخرى...

### 3. كيف تعمل الصفحات الآن

**قبل:**
```typescript
// كانت تتحقق من البيانات الفارغة وتستخدم mock data
const data = await service.getAll();
if (data.length === 0) {
  setData(mockData);
}
```

**بعد:**
```typescript
// الآن تستخدم البيانات من Supabase مباشرة
const data = await service.getAll();
setData(data);
```

## استكشاف الأخطاء

### إذا فشلت عملية النقل

1. تحقق من اتصال Supabase في ملف `.env`
2. تحقق من أن جميع الجداول موجودة في قاعدة البيانات
3. راجع رسائل الخطأ في وحدة التحكم
4. يمكنك إعادة المحاولة - العملية آمنة للتكرار

### إذا كانت الصفحات لا تعرض البيانات

1. تأكد من أن عملية النقل اكتملت بنجاح
2. حدّث الصفحة (Refresh)
3. تحقق من وحدة تحكم المتصفح للأخطاء
4. تحقق من أن Supabase متصل بشكل صحيح

## الخطوات التالية

بعد نقل البيانات بنجاح، يمكنك:

1. البدء في إضافة بيانات جديدة
2. تعديل البيانات الموجودة
3. حذف البيانات غير المطلوبة
4. جميع التغييرات ستحفظ في قاعدة البيانات الحقيقية

## معلومات تقنية

### البيانات التي يتم نقلها

- **12 جدول** في قاعدة البيانات
- **مئات السجلات** عبر جميع الجداول
- **علاقات محفوظة** بين الجداول (Foreign Keys)

### تحويل البيانات

- تحويل أسماء الحقول من camelCase إلى snake_case
- تحويل التواريخ إلى تنسيق ISO
- معالجة البيانات المتداخلة (JSONB)
- الحفاظ على العلاقات والارتباطات

## الدعم

إذا واجهت أي مشاكل، تحقق من:
- ملف UPDATES.md للتحديثات الأخيرة
- وحدة تحكم المتصفح للأخطاء
- سجلات Supabase

---

تم إنشاء هذا الدليل في: 2025-12-25
